# ๐ ะะธะบัะพัะตัะฒะธัะฝะฐั ัะธััะตะผะฐ ะฝะพัะธัะธะบะฐัะธะน ะฝะฐ Go

![Go Version](https://img.shields.io/badge/Go-1.25.1-00ADD8?logo=go&style=flat-square)
![Docker](https://img.shields.io/badge/Docker-Available-2496ED?logo=docker&style=flat-square)
![Apache Kafka](https://img.shields.io/badge/Kafka-Event_Driven-231F20?logo=apachekafka&style=flat-square)
![Redis](https://img.shields.io/badge/Redis-Caching-DC382D?logo=redis&style=flat-square)
![PostgreSQL](https://img.shields.io/badge/PostgreSQL-Persistence-336791?logo=postgresql&style=flat-square)

## ๐ ะัะฐัะบะพะต ะพะฟะธัะฐะฝะธะต

ะัะพะตะบั ะฟัะตะดััะฐะฒะปัะตั ัะพะฑะพะน ะผะฐัััะฐะฑะธััะตะผัั ัะธััะตะผั ะผะธะบัะพัะตัะฒะธัะพะฒ ะดะปั ัะฟัะฐะฒะปะตะฝะธั ะฟะพะปัะทะพะฒะฐัะตะปัะผะธ ะธ ะดะพััะฐะฒะบะธ ัะฒะตะดะพะผะปะตะฝะธะน. ะะตะฐะปะธะทะพะฒะฐะฝะฐ ั ะธัะฟะพะปัะทะพะฒะฐะฝะธะตะผ ะฟะฐััะตัะฝะฐ **Event-Driven Architecture**, ะณะดะต ัะตัะฒะธัั ะฒะทะฐะธะผะพะดะตะนััะฒััั ะฐัะธะฝััะพะฝะฝะพ ัะตัะตะท Apache Kafka.


---

## ๐ ะะณะปะฐะฒะปะตะฝะธะต

- [ะััะธัะตะบัััะฐ](#-ะฐััะธัะตะบัััะฐ)
- [ะขะตัะฝะพะปะพะณะธัะตัะบะธะน ััะตะบ](#-ัะตัะฝะพะปะพะณะธัะตัะบะธะน-ััะตะบ)
- [ะัััััะน ััะฐัั](#-ะฑัััััะน-ััะฐัั)
- [API Endpoints](#-api-endpoints)
  - [User Service API](#user-service-api)
  - [Notification Service API](#notification-service-api)
- [ะะปััะตะฒัะต ัะตัะตะฝะธั ัะตะฐะปะธะทะฐัะธะธ](#-ะบะปััะตะฒัะต-ัะตัะตะฝะธั-ัะตะฐะปะธะทะฐัะธะธ)
- [ะกัััะบัััะฐ ะฟัะพะตะบัะฐ](#-ััััะบัััะฐ-ะฟัะพะตะบัะฐ)
- [ะัะธะผะตัั ะทะฐะฟัะพัะพะฒ](#-ะฟัะธะผะตัั-ะทะฐะฟัะพัะพะฒ)

---

## ๐ ะััะธัะตะบัััะฐ

ะกะธััะตะผะฐ ัะฐะทะดะตะปะตะฝะฐ ะฝะฐ ะดะฒะฐ ะฝะตะทะฐะฒะธัะธะผัั ะผะธะบัะพัะตัะฒะธัะฐ, ะบะฐะถะดัะน ะธะท ะบะพัะพััั ะธะผะตะตั ัะพะฑััะฒะตะฝะฝัั ะทะพะฝั ะพัะฒะตัััะฒะตะฝะฝะพััะธ ะธ ะฑะฐะทั ะดะฐะฝะฝัั.

### 1. User Service (ะฟะพัั `8080`)

ะัะฒะตัะฐะตั ะทะฐ ัะตะณะธัััะฐัะธั, ะฐััะตะฝัะธัะธะบะฐัะธั ะธ ัะฟัะฐะฒะปะตะฝะธะต ะถะธะทะฝะตะฝะฝัะผ ัะธะบะปะพะผ ะฟะพะปัะทะพะฒะฐัะตะปะตะน.

- ะฅัะฐะฝะธั ะดะฐะฝะฝัะต ะฒ **PostgreSQL** (`user_db`);
- ะะตะฝะตัะธััะตั ัะพะฑััะธั `UserCreated` ะธ `UserDeleted`;
- ะัะฑะปะธะบัะตั ัะพะฑััะธั ะฒ ัะพะฟะธะบ **Kafka** `user-events`.

### 2. Notification Service (ะฟะพัั `8081`)

ะฃะฟัะฐะฒะปัะตั ัะฒะตะดะพะผะปะตะฝะธัะผะธ ะธ inbox ะฟะพะปัะทะพะฒะฐัะตะปะตะน.

- ะกะปััะฐะตั ัะพะฟะธะบ `user-events` ัะตัะตะท **Kafka Consumer Group**;
- ะฅัะฐะฝะธั ัะฒะตะดะพะผะปะตะฝะธั ะฒ **PostgreSQL** (`notification_db`);
- ะะพะดะดะตัะถะธะฒะฐะตั ะปะพะบะฐะปัะฝัั ัะฐะฑะปะธัั `user_shadow` ะดะปั ะฒะฐะปะธะดะฐัะธะธ ะฟะพะปััะฐัะตะปะตะน ะฑะตะท HTTP-ะทะฐะฟัะพัะพะฒ ะบ User Service;
- ะัะฟะพะปัะทัะตั **Redis** ะดะปั ะบััะธัะพะฒะฐะฝะธั ัะฟะธัะบะฐ ัะฒะตะดะพะผะปะตะฝะธะน.

---

## ๐ ะขะตัะฝะพะปะพะณะธัะตัะบะธะน ััะตะบ

| ะะพะผะฟะพะฝะตะฝั | ะขะตัะฝะพะปะพะณะธั | ะะฐะทะฝะฐัะตะฝะธะต |
|----------|------------|------------|
| **Language** | Go 1.25.1 | ะัะฝะพะฒะฝะพะน ัะทัะบ ัะฐะทัะฐะฑะพัะบะธ |
| **Database** | PostgreSQL | ะะตััะธััะตะฝัะฝะพะต ััะฐะฝะธะปะธัะต ะดะฐะฝะฝัั |
| **Message Broker** | Apache Kafka | ะัะธะฝััะพะฝะฝัะน ะพะฑะผะตะฝ ัะพะฑััะธัะผะธ ะผะตะถะดั ัะตัะฒะธัะฐะผะธ |
| **Cache** | Redis | ะััะธัะพะฒะฐะฝะธะต Inbox (ัะฟะธัะบะฐ ัะฒะตะดะพะผะปะตะฝะธะน) |
| **Auth** | JWT (JSON Web Token) | Stateless-ะฐััะตะฝัะธัะธะบะฐัะธั ะธ ะฐะฒัะพัะธะทะฐัะธั |
| **Containerization** | Docker & Docker Compose | ะะทะพะปััะธั ะพะบััะถะตะฝะธั ะธ ะพัะบะตัััะฐัะธั |

---

## ๐ ะัััััะน ััะฐัั

### 1. ะะปะพะฝะธัะพะฒะฐะฝะธะต ัะตะฟะพะทะธัะพัะธั

```bash
git clone https://github.com/cimacita/NotifyProject
cd NotifyProject
```

## 2. ะะฐัััะพะนะบะฐ ะพะบััะถะตะฝะธั

ะัะพะตะบั ะธัะฟะพะปัะทัะตั `.env` ัะฐะนะปั ะดะปั ะบะพะฝัะธะณััะฐัะธะธ.  
ะฃะฑะตะดะธัะตัั, ััะพ ะพะฝะธ ะตััั ะฒ ะบะพัะฝัั ัะตัะฒะธัะพะฒ ะธะปะธ ะธัะฟะพะปัะทััััั ะดะตัะพะปัะฝัะต ะทะฝะฐัะตะฝะธั ะธะท `docker-compose.yml`.

---

## 3. ะะฐะฟััะบ

```bash
docker-compose up --build
```

ะะธะณัะฐัะธะธ ะฑะฐะทั ะดะฐะฝะฝัั ะฟัะธะผะตะฝััััั ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฟัะธ ะทะฐะฟััะบะต ะบะพะฝัะตะนะฝะตัะพะฒ (ะฟะฐะฟะบะฐ `initdb`).

---

## ๐ API Endpoints

### User Service API

**Base URL:** `http://localhost:8080`

| ะะตัะพะด  | ะััั       | ะะฟะธัะฐะฝะธะต                                           | ะััะตะฝัะธัะธะบะฐัะธั |
|------|------------|----------------------------------------------------|----------------|
| POST | `/register` | ะะตะณะธัััะฐัะธั ะฝะพะฒะพะณะพ ะฟะพะปัะทะพะฒะฐัะตะปั                    | โ ะะตั |
| POST | `/login`    | ะัะพะด ะฟะพ email/password ะธ ะฟะพะปััะตะฝะธะต JWT             | โ ะะตั |
| DELETE | `/user`   | ะฃะดะฐะปะตะฝะธะต ัะตะบััะตะณะพ ะฟะพะปัะทะพะฒะฐัะตะปั (Soft Delete)       | โ Bearer Token |

---

### Notification Service API

**Base URL:** `http://localhost:8081`

| ะะตัะพะด  | ะััั                     | ะะฟะธัะฐะฝะธะต                                      | ะััะตะฝัะธัะธะบะฐัะธั |
|------|--------------------------|-----------------------------------------------|----------------|
| POST | `/notifications`          | ะัะฟัะฐะฒะธัั ัะฒะตะดะพะผะปะตะฝะธะต ะฟะพะปัะทะพะฒะฐัะตะปั            | โ Bearer Token |
| GET | `/notifications`          | ะะพะปััะธัั ัะฟะธัะพะบ ะฒัะพะดััะธั (Inbox)              | โ Bearer Token |
| PATCH | `/notifications/{id}`   | ะะพะผะตัะธัั ัะฒะตะดะพะผะปะตะฝะธะต ะบะฐะบ ะฟัะพัะธัะฐะฝะฝะพะต          | โ Bearer Token |
| DELETE | `/notifications/{id}`  | ะฃะดะฐะปะธัั ัะฒะตะดะพะผะปะตะฝะธะต                           | โ Bearer Token |

---

## ๐ก ะะปััะตะฒัะต ัะตัะตะฝะธั ัะตะฐะปะธะทะฐัะธะธ

### ๐น Cache-Aside Strategy

ะะปั ัะฝะธะถะตะฝะธั ะฝะฐะณััะทะบะธ ะฝะฐ ะะ ะฟัะธ ัะฐัััั ะทะฐะฟัะพัะฐั ัะฟะธัะบะฐ ัะฒะตะดะพะผะปะตะฝะธะน (`GET /notifications`) ะธัะฟะพะปัะทัะตััั ะฟะฐััะตัะฝ **Cache-Aside**:

- ะกะตัะฒะธั ัะฝะฐัะฐะปะฐ ะธัะตั ะดะฐะฝะฝัะต ะฒ Redis;
- ะัะธ ะพััััััะฒะธะธ ะดะฐะฝะฝัั (**Cache Miss**) ะฒัะฟะพะปะฝัะตััั ะทะฐะฟัะพั ะฒ PostgreSQL;
- ะะตะทัะปััะฐั ัะพััะฐะฝัะตััั ะฒ Redis ั TTL **5 ะผะธะฝัั**;
- ะัะธ ะปัะฑะพะผ ะธะทะผะตะฝะตะฝะธะธ (ะฝะพะฒะพะต ัะฒะตะดะพะผะปะตะฝะธะต, ัะดะฐะปะตะฝะธะต, ะฟัะพััะตะฝะธะต) ะบัั ะฟะพะปัะทะพะฒะฐัะตะปั ะฟัะธะฝัะดะธัะตะปัะฝะพ ะธะฝะฒะฐะปะธะดะธััะตััั.

---

### ๐น Event-Driven Architecture

ะะผะตััะพ ัะธะฝััะพะฝะฝัั HTTP-ะฒัะทะพะฒะพะฒ, ัะพะทะดะฐััะธั ะถะตััะบัั ัะฒัะทะฝะพััั, User Service ะฟัะฑะปะธะบัะตั ัะพะฑััะธั ะฒ **Kafka**, ะฐ Notification Service ัะตะฐะณะธััะตั ะฝะฐ ะฝะธั ะฐะฒัะพะฝะพะผะฝะพ:

**UserCreated**
- ัะพะทะดะฐะตััั Shadow User  
- ะพัะฟัะฐะฒะปัะตััั Welcome Notification  

**UserDeleted**
- Shadow User ะฟะพะผะตัะฐะตััั ัะดะฐะปะตะฝะฝัะผ  
- ัะฒะตะดะพะผะปะตะฝะธั ะฟะพะปัะทะพะฒะฐัะตะปั ะพัะธัะฐัััั  

---

### ๐น ะะตะทะพะฟะฐัะฝะพััั

- **JWT Middleware** โ ะฟัะพะฒะตัะบะฐ ะฟะพะดะฟะธัะธ, ะฒะฐะปะธะดะฝะพััะธ ัะพะบะตะฝะฐ
- **Shadow User Validation** โ ะฟัะพะฒะตัะบะฐ ัััะตััะฒะพะฒะฐะฝะธั ะธ ะฐะบัะธะฒะฝะพััะธ ัะทะตัะฐ ะฟะตัะตะด ะพัะฟัะฐะฒะบะพะน ัะฒะตะดะพะผะปะตะฝะธั
- **Bcrypt** โ ะฟะฐัะพะปะธ ััะฐะฝัััั ะธัะบะปััะธัะตะปัะฝะพ ะฒ ัะตัะธัะพะฒะฐะฝะฝะพะผ ะฒะธะดะต

---

## ๐ ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```text
.
โโโ docker-compose.yml
โโโ initdb/
โ   โโโ 01_create_databases.sql
โ   โโโ 02_create_users_tables.sql
โ   โโโ 03_create_notifications_tables.sql
โ
โโโ notification-service/
โ   โโโ .env
โ   โโโ Dockerfile
โ   โโโ go.mod
โ   โโโ go.sum
โ   โ
โ   โโโ cmd/
โ   โ   โโโ main.go
โ   โ
โ   โโโ config/
โ   โ   โโโ config.go
โ   โ
โ   โโโ internal/
โ   โ   โโโ db/
โ   โ   โ   โโโ postgres.go
โ   โ   โ
โ   โ   โโโ events/
โ   โ   โ   โโโ eventHandler.go
โ   โ   โ   โโโ events.go
โ   โ   โ
โ   โ   โโโ notification/
โ   โ   โ   โโโ cache.go
โ   โ   โ   โโโ handler.go
โ   โ   โ   โโโ model.go
โ   โ   โ   โโโ payload.go
โ   โ   โ   โโโ repository.go
โ   โ   โ   โโโ service.go
โ   โ   โ
โ   โ   โโโ userShadow/
โ   โ       โโโ model.go
โ   โ       โโโ repository.go
โ   โ
โ   โโโ pkg/
โ       โโโ auth/
โ       โ   โโโ errors.go
โ       โ   โโโ JWTManager.go
โ       โ   โโโ middleware.go
โ       โ
โ       โโโ cache/
โ       โ   โโโ redis.go
โ       โ
โ       โโโ kafka/
โ           โโโ consumer.go
โ
โโโ user-service/
โ   โโโ .env
โ   โโโ Dockerfile
โ   โโโ go.mod
โ   โโโ go.sum
โ   โ
โ   โโโ cmd/
โ   โ   โโโ main.go
โ   โ
โ   โโโ config/
โ   โ   โโโ config.go
โ   โ
โ   โโโ internal/
โ   โ   โโโ db/
โ   โ   โ   โโโ postgres.go
โ   โ   โ
โ   โ   โโโ events/
โ   โ   โ   โโโ events.go
โ   โ   โ
โ   โ   โโโ user/
โ   โ       โโโ errors.go
โ   โ       โโโ handler.go
โ   โ       โโโ model.go
โ   โ       โโโ payload.go
โ   โ       โโโ repository.go
โ   โ       โโโ service.go
โ   โ
โ   โโโ pkg/
โ       โโโ auth/
โ       โ   โโโ errors.go
โ       โ   โโโ JWTManager.go
โ       โ   โโโ middleware.go
โ       โ
โ       โโโ kafka/
โ           โโโ producer.go
```

---

## ๐ป ะัะธะผะตัั ะทะฐะฟัะพัะพะฒ

### 1. ะะตะณะธัััะฐัะธั ะฟะพะปัะทะพะฒะฐัะตะปั

```bash
curl -X POST http://localhost:8080/register \
  -H "Content-Type: application/json" \
  -d '{"email": "test@example.com", "password": "securepassword"}'
```

### 2. ะะพะณะธะฝ (ะฟะพะปััะตะฝะธะต JWT)

```bash
curl -X POST http://localhost:8080/login \
  -H "Content-Type: application/json" \
  -d '{"email": "test@example.com", "password": "securepassword"}'
```

### 3. ะัะพะฒะตัะบะฐ ัะฒะตะดะพะผะปะตะฝะธะน (Inbox)

```bash
curl -X GET http://localhost:8081/notifications \
  -H "Authorization: Bearer <YOUR_JWT_TOKEN>"
```
